---
title: "Analysis of Diabetes Health Indicators / Dataset by Behavioral Risk Factor Surveillance System"
author: "Juan José Tirado Pulido / Sheddad"
note: "The survey was established in 1984. Data are collected monthly in all 50 states, Puerto Rico, the U.S. Virgin islands, and Guam."
date: "January 2023"
output: 
  cleanrmd::html_document_clean: 
    toc: true
    toc_float: true
    number_sections: true
    theme: water-dark
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r, include=FALSE}
library('ggplot2')
library(sqldf)
library(RSQLite)
```
# Introducción

La diabetes es una afección de salud crónica que afecta la manera en que el cuerpo humano procesa el azúcar (glucosa). La glucosa es una importante fuente de energía para tu cuerpo, pero necesita la hormona insulina para ayudar a transportarla desde la sangre hasta las células.

Existen dos tipos principales de diabetes: tipo 1 y tipo 2.

La diabetes tipo 1 es un trastorno autoinmune en el cual el sistema inmunitario del cuerpo ataca y destruye las células del páncreas que producen insulina. Esto resulta en una falta completa de insulina, y las personas con diabetes tipo 1 deben recibir inyecciones de insulina o usar una bomba de insulina para controlar sus niveles de azúcar en sangre.

La diabetes tipo 2 es la forma más común de diabetes y suele ser causada por una combinación de factores genéticos y de estilo de vida, como tener sobrepeso o ser sedentario. En la diabetes tipo 2, las células del cuerpo no responden adecuadamente a la insulina (una condición conocida como resistencia a la insulina) o el páncreas no produce suficiente insulina para satisfacer las necesidades del cuerpo. Las personas con diabetes tipo 2 pueden poder controlar sus niveles de azúcar en sangre con una dieta saludable, ejercicio y medicamentos orales, pero algunas también pueden necesitar inyecciones de insulina.

Ambos tipos de diabetes pueden conducir a complicaciones de salud graves si no se tratan, incluyendo enfermedades cardíacas, daño nervioso, ceguera y daño renal.

# Preguntas generales

Estas preguntas fueron propuestas en el sitio web ([KAGGLE](https://www.kaggle.com/datasets/alexteboul/diabetes-health-indicators-dataset)) 

 * ¿Pueden las preguntas de encuesta del BRFSS proporcionar predicciones precisas de si un individuo tiene diabetes?
 * ¿Cuáles son los factores de riesgo más predictivos del riesgo de diabetes?
 * ¿Podemos usar un subconjunto de los factores de riesgo para predecir con precisión si un individuo tiene diabetes?
 * ¿Podemos crear una forma abreviada de preguntas del BRFSS utilizando la selección de características para predecir con precisión si alguien puede tener diabetes o está en alto riesgo de diabetes?
En primer lugar, exploraremos el conjunto de datos y al final del estudio podremos responderlas con precisión.

# Sección 1
Exploremos el tipo de archivos que se importarán y las variables relevantes de estudio.
```{r}
diabetes_dataset <- read.csv("dataset/diabetes_012_health_indicators_BRFSS2015.csv",
                             header = TRUE, strip.white = TRUE)
#Removing NA's from dataset
diabetes_dataset[is.na(diabetes_dataset)] <- 0

names(diabetes_dataset)
```
Las variables son:

 * Diabetes_012: 0 = no diabetes 1 = prediabetes 2 = diabetes
 
 * HighBP: 0 = no high BP 1 = high BP
 
 * HighChol: 0 = no high cholesterol 1 = high cholesterol
 
 * CholCheck: 0 = no cholesterol check in 5 years 1 = yes cholesterol check in 5 years
 
 * BMI: Body Mass Index
 
 * Smoker: Have you smoked at least 100 cigarettes in your entire life? [Note: 5 packs = 100 cigarettes] 0 = no 1 = yes            
 
 * Stroke: You ever had a stroke. 0 = no 1 = yes
 
 * HeartDiseaseorAttack: coronary heart disease (CHD) or myocardial infarction (MI) 0 = no 1 = yes
 
 * PhysActivity: physical activity in past 30 days - not including job 0 = no 1 = yes
 
 * Fruits: Consume Fruit 1 or more times per day 0 = no 1 = yes
 
 * Veggies: Consume Vegetables 1 or more times per day 0 = no 1 = yes   
 
 * HvyAlcoholConsump: Heavy drinkers (adult men having more than 14 drinks per week and adult women having more than 7 drinks per week) 0 = no 1 = yes
 
 * AnyHealthcare: Have any kind of health care coverage, including health insurance, prepaid plans such as HMO, etc. 0 = no 1 = yes
 
 * NoDocbcCost: Was there a time in the past 12 months when you needed to see a doctor but could not because of cost? 0 = no 1 = yes
 
 * GenHlth: Would you say that in general your health is: scale 1-5 1 = excellent 2 = very good 3 = good 4 = fair 5 = poor
 
 * MentHlth: Now thinking about your mental health, which includes stress, depression, and problems with emotions, for how many days during the past 30 days was your mental health not good?
 
 * PhysHlth: Now thinking about your physical health, which includes physical illness and injury, for how many days during the past 30 days was your physical health not good?
 
 * DiffWalk: Do you have serious difficulty walking or climbing stairs? 0 = no 1 = yes     
 * Sex: 0 = female 1 = male  
 
 * Age: 13-level age category ([_AGEG5YR](https://www.icpsr.umich.edu/web/NAHDAP/studies/34085/datasets/0001/variables/AGEG5YR?archive=NAHDAP)) 
 
 * Education: Education level ([EDUCA](https://www.icpsr.umich.edu/web/NAHDAP/studies/34085/datasets/0001/variables/EDUCA?archive=NAHDAP))  

 * Income: Income scale ([INCOME2](https://www.icpsr.umich.edu/web/RCMD/studies/34085/datasets/0001/variables/INCOME2?archive=RCMD)) 

## Does mental health lead to unhealthy eating patterns?

What we are now doing is to check the general health using mental health as a way of subsetting the dataset. Why we choose to explore this? To understand if mental health leads to eating disorders, that can lead to unhealthy eating patterns ultimately leading to diabetes type II.

```{r}
women_diabetes_dataset <- subset(diabetes_dataset, diabetes_dataset$Sex == 0)
```

We are checking the general health of women feeling negative emotions 10 or more   times a month.

```{r}
#Women with stable mental health = 0 days of no problems.
women_mental_health_stable <- subset(women_diabetes_dataset, 
                                     women_diabetes_dataset$MentHlth == 0)

#Women with more or equal than 10 days feeling not good with theirmental health
women_mental_health__more_than_10_days <- subset(women_diabetes_dataset, 
                                                women_diabetes_dataset$MentHlth >= 10)

colMeans(women_mental_health__more_than_10_days[c('BMI',
                                                 'GenHlth', 
                                                 'MentHlth', 
                                                 'PhysHlth',
                                                 'Age')], 
         na.rm = TRUE) 
```

This means that the mean of women that feel psychologically bad 10 or more days have a BMI greater than 24.9, which we could consider overweight. Also the mean of physical health problems is 11.8 days in the month, and the mean of the age is between 50 and 54 years old. The mean of general health measurement is 'fair'.

```{r}
men_diabetes_dataset <- subset(diabetes_dataset, diabetes_dataset$Sex == 1)
```

Now let's do the same for men.

```{r}
#Men with more or equal than 10 days feeling not good with their mental health
men_mental_health__more_than_10_days <- subset(men_diabetes_dataset, 
                                                men_diabetes_dataset$MentHlth >= 10)

colMeans(men_mental_health__more_than_10_days[c('BMI',
                                                 'GenHlth', 
                                                 'MentHlth', 
                                                 'PhysHlth',
                                                 'Age')], 
         na.rm = TRUE) 
```

The mean of men that feel psychologically bad 10 or more days have a BMI greater than 24.9, which we could consider overweight. Also the mean of physical health problems is 12 days in the month, and the mean of the age is between 50 and 54 years old. The mean of general health measurement is 'fair'.

There's no significant difference between men and women

Vamos a crear 
```{r}
sqldf("SELECT Diabetes_012, HighBP, HighChol, AVG(PhysActivity), AVG(HeartDiseaseorAttack), AVG(Income), AVG(Veggies), AVG(Age), 
        Count(*) * 100.0/ SUM(COUNT(*)) OVER () as percentage
      FROM women_mental_health_stable
      GROUP BY Diabetes_012, HighBP, HighChol")
```
```{r}
sqldf("SELECT Diabetes_012, HighBP, HighChol, AVG(PhysActivity), AVG(HeartDiseaseorAttack), AVG(Income), AVG(Age),                            Count(*) * 100.0 / SUM(COUNT(*)) OVER () as percentage
      FROM women_mental_health__more_than_3_days
      GROUP BY Diabetes_012, HighBP, HighChol")
```
Hemos encontrado conclusiones muy interesantes. De media, las mujeres con más inestabilidad emocional con respecto a las más estables tienden a:

 * Tener menor poder adquisitivo, lo que puede darnos una pista de que su alimentación podría ser de menor calidad.
 * Hacer menos ejercicio.
 * Sufrir mayor número de cardiopatías.
 * Sufren alta presión arterial y colesterol más jóvenes. 
 * Son diagnosticados con diabetes más jóvenes.

También podemos comprobar que, en general, la edad media juega un factor fundamental en el diagnóstico de la diabetes, ya que cuanto más avanza la edad, más avanzan los problemas de prediabetes/diabetes, presión arterial y colesterol.

```{r}
sqldf("SELECT Diabetes_012, HighBP, HighChol, AVG(PhysActivity), AVG(Income),             AVG(Age), Count(*) * 100.0/SUM(COUNT(*)) OVER () as percentage
      FROM men_mental_health__more_than_10_days
      GROUP BY Diabetes_012, HighBP, HighChol")
```

